.. doctest-skip-all

.. _whatsnew-3.1:

************************
What's New in SunPy 3.1?
************************

Overview
========
The SunPy project is pleased to announce the 3.1 release of the sunpy package.

On this page, you can read about some of the big changes in this release:

* :ref:`whatsnew-3.1-python`

SunPy 3.1 also includes a large number of smaller improvements and bug fixes, which are described in the :ref:`changelog`.

By the numbers:

* X commits have been added since 3.0
* X issues have been closed since 3.0
* X pull requests have been merged since 3.0
* X people have contributed since 3.0
* X of which are new contributors

Please find below a selection of what we consider to be the biggest changes or features with this release.

.. _whatsnew-3.1-python:

Increase in required package versions
=====================================
We have bumped the minimum version of several packages we depend on; these are the new minimum versions for sunpy 3.1:

.. _whatsnew-3.1-contributors:

Changes to map date/time handling
=================================

New date properties
-------------------
The properties `~sunpy.map.GenericMap.date_start`,
`~sunpy.map.GenericMap.date_end`, and `~sunpy.map.GenericMap.date_average` have
been added to be drawn from the relevant FITS metadata, if present in the map
header. These are from new keywords defined in version 4 of the FITS standard,
which have precise meanings compared to the previously ill-defined DATE-OBS.

Changes to `~sunpy.map.GenericMap.date`
---------------------------------------
`sunpy.map.GenericMap.date` now looks for more metadata than just DATE-OBS.
This property can return any one of the new properties (see above) depending
on the metadata present in the map. It now draws from, in order of preference:

1. The DATE-OBS FITS keyword
2. `~sunpy.map.GenericMap.date_average`
3. `~sunpy.map.GenericMap.date_start`
4. `~sunpy.map.GenericMap.date_end`
5. The current time.

If DATE-OBS is present alongside DATE-AVG or DATE-BEG and DATE-END, this results
in a behaviour change to favour the new (more precisely defined) keywords.
It is recommended
to use `~sunpy.map.GenericMap.date_average`,
`~sunpy.map.GenericMap.date_start`, or `~sunpy.map.GenericMap.date_end`
instead if you need one of these specific times.

Addition of new time format `~sunpy.time.formats.TimeTaiSeconds`
----------------------------------------------------------------
The `~sunpy.time.formats.TimeTaiSeconds` format is the number of seconds
since 1958-01-01 00:00:00, including leap seconds. This is equivalent to
`~astropy.time.TimeUnixTai`, except that the epoch is 12 years earlier.

For dates on and after 1972-01-01 00:00:00 UTC, this format is
equivalent to that returned by the ``anytim2tai`` routine in SSW.
For dates between 1958-01-01 00:00:00 UTC and 1971-12-31 23:59:59 UTC,
``anytim2tai`` returns a constant difference of 9 s difference between
UTC and TAI (i.e. the number of leap seconds added since 1958-01-01 00:00:00)
while `~astropy.time.Time` returns a 0 s on 1958-01-01 00:00:00 (when
UT and TAI were synchronized) and increases approximately linearly to a
differnce of 10 s on 1972-01-01 00:00:00.

Contributors to this Release
============================
